<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<script type="text/javascript" src="jquery-2.0.3.min.js" ></script>
		<script type="text/javascript" src="dist/lrz.all.bundle.js" ></script>
		<title></title>
		<style>
		input::-webkit-input-placeholder{
        	color:rgba(240,240,240,0.9);
        	letter-spacing: 0.2vw;
        }
        input::-moz-placeholder{   /* Mozilla Firefox 19+ */
            color:rgba(240,240,240,0.9);
            letter-spacing: 0.2vw;
        }
        input:-moz-placeholder{    /* Mozilla Firefox 4 to 18 */
            color:rgba(240,240,240,0.9);
            letter-spacing: 0.2vw;
        }
        input:-ms-input-placeholder{  /* Internet Explorer 10-11 */ 
            color:rgba(240,240,240,0.9);
            letter-spacing: 0.2vw;
        }
			*{
				padding: 0;
				margin: 0 auto;
				font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
			}
			input{
				outline: 0;
				border: 0;
			}
			html{
				height: 100%;
			}
			body{
				height: 100%;
				background-color: #FBF9E2;
			}
			button{
				outline:0;
				border: 0;
			}
			.button{
				width: 20%;
				font-size: 4.5vw;
				font-weight: 300;
				line-height: 8vw;
				height: 8vw;
				color: rgba(255,255,255,0.95);;
				text-align: center;
				border-top-left-radius: 22% 50%;
    			border-top-right-radius: 22% 50%;
    			border-bottom-left-radius: 22% 50%;
    			border-bottom-right-radius: 22% 50%;
				background-color: #F09646;
				margin-left: 40%;
				margin-top: 8%;
			}
			.id{
				width: 60%;
				position: absolute;
				margin-left: 20%;
				bottom: 20%;
				height: 8vw;
			}
			#id{
				padding-left: 20%;
				width: 80%;
				font-size: 4.5vw;
				height: 8vw;
				background-color: rgba(111,133,154,0.7);
				border-top-left-radius: 6% 50%;
    			border-top-right-radius: 6% 50%;
    			border-bottom-left-radius: 6% 50%;
    			border-bottom-right-radius: 6% 50%;
				color:rgba(240,240,240,0.9);
				box-shadow: 0px 0px 2px #1A3C63; 
			}
			.id img{
				position: absolute;
				top: 20%;
				left: 6%;
				height: 5vw;
			}
			.page1{
				height: 100%;
				background-image: url(bc.png);
				background-size: 100% 100%;
			}
			.page1_5{
				width: 100%;
				height: 70%;
				background-color: #FBF9E2;
				position: absolute;
				bottom: 0;
				top: 0;
				margin:auto auto;
				display: none;
			}
			#page2{
				width: 100%;
				height: 100%;
				display: none;
				position: relative;
			}
			.name{
				width: 58%;
				position: relative;
				height: 8vw;
				margin-top: 6%;
				text-align: center;
			}
			.err{
				position: absolute;
				left: 7.5%;
				bottom: -76%;
				font-size: 3.5vw;
				color:red ;
			}
			.tl_1{
				width: 100%;
				text-align: center;
				font-size: 10vw;
				font-weight: 300;
				color: #F6821D;
			}
			.tl_1 span{
				font-weight: 600;
			}
			.tl_2{
				margin-top: 4%;
				width: 100%;
				text-align: center;
				font-size: 4vw;
				color: #F7C574;
				font-weight: 500;
			}
			#can{
				border: 2px solid #0A3444;
				display: none;
			}
			.hint{
				width: 100%;
				color: #F6821D;
				font-size: 8vw;
				text-align: center;
				margin-bottom: 25%;
			}
			#photo{
				border: 1px solid;
				margin-bottom: 25%;
			}
			.inputfile {
            	opacity: 0;
            	display: none;
        	}
        	.button2{
        		float: left;
        		margin-left: 15%;
        		height: 100%;
        		width: 20%;
        		background-color: #F67706;
        		color: rgba(255,255,255,0.95);
        		border-radius: 5%;
        		text-align: center;
        		padding-top: 1%;
        		padding-bottom: 1%;
        	}
        	.submit{
        		float: left;
        		width: 20%;
        		height: 100%;
        		margin-left: 30%;
        		border-radius: 5%;
        		background-color: #F67706;
        		color: rgba(255,255,255,0.95);
        		text-align: center;
        		padding-top: 1%;
        		padding-bottom: 1%;
        	}
        	.btm{
        		height: 4%;
        		width: 100%;
        	}
        	#screen{
        		zoom: 0.125;
        	}
        	#im{
        		border: 8px solid #0A3444;
        	}
        	.bott{
        		width: 100%;
        		position: absolute;
        		bottom: 2%;
        	}
        	#download{
        		text-decoration: none;
        		display: block;
        		width: 36%;
        		border-radius: 5%;
        		color: white;
        		text-align: center;
        		padding-top: 1%;
        		padding-bottom: 1%;
        		background-color: #F6821D;
        	}
        	.logo{
        		width: 100%;
        		position: absolute;
        		top: 20%;
        	}
        	.logo img{
        		width: 28%;
        		margin-left: 36%;
        	}
        	#login{
        		width: 30%;
        		height: 12vw;
        		position: absolute;
        		bottom: 9%;
        		font-size: 4.5vw;
        		text-align: center;
        		margin-left: 35%;
        		background-color: rgba(111,133,154,0.7);
				border-top-left-radius: 16% 50%;
    			border-top-right-radius: 16% 50%;
    			border-bottom-left-radius: 16% 50%;
    			border-bottom-right-radius: 16% 50%;
				color:rgba(240,240,240,0.9);
				box-shadow: 0px 0px 2px #1A3C63; 
        	}
        	#err2{
        		margin-left: 20%;
        		color: red;
        		font-size: 4vw;
        	}
        	#na{
        		width: 100%;
        		text-align: center;
        		color: red;
        		position: absolute;
        		bottom: 4%;
        		font-size: 4.5vw;
        	}
		</style>
	</head>
	<body>
	<div class="page1">
		<div class="logo">
					<img src="Logo.png" />
		</div>
		<div class="id">
			<input type="number" placeholder="输入你的编号噢~" id="id"/>
			<img src="hint.png" />
			<span id="err2"></span>
		</div>
		<button id="login">认&nbsp;&nbsp; 证 </button>
	</div>
	<div class="page1_5">
		<div class="main">
			<div class="hint">拍摄你的荣誉照片</div>
			<div id="photo">
				
			</div>
			<div class="btm">
			<input type="file" name="file" id="file" class="inputfile" accept="image/png, image/jpeg, image/gif, image/jpg"  capture="camera"/>
			<label for="file" class='button2'>重拍</label>
			<div class="submit">
				生成证书
			</div>
		</div>
		</div>
	</div>
	<div id="page2">
		<div id="screen">
			<img id="im" />
			<canvas id="can"></canvas>
		</div>
		<div class="bott">
			<div id="download" target="_blank">长按证书保存</div>
		</div>
	</div>
	<script>
		$(document).ready(function(){
			var img1 = new Image();
			var img2 = new Image();
			var img3 = new Image();
			var can = document.getElementById('can');
			var im = document.getElementById('im');
			var id = document.getElementById('id');
			var na = document.getElementById('na');
			var nu = document.getElementById('nu');
			var login=document.getElementById("login");
			var name = document.getElementById('name');
			var photo = document.getElementById('photo');
			var width = document.documentElement.clientWidth || document.body.clientWidth;
			var height = document.documentElement.clientHeight || document.body.clientHeight;
			var screen1 = document.getElementById('screen');
			var err1 = document.getElementById('err1');
			var err2 = document.getElementById('err2');
			var download=document.getElementById('download');
			var sure=document.getElementById("sure");
			var flag=0, number=0;
		 	var username,authflag=0,authflaged;
			photo.style.height=height*0.28+"px";
			photo.style.width=height*0.21+"px";
			can.width =  height*0.85*8*(720/1206);
			can.height = height*0.85*8;
			im.width =  height*0.85*8*(720/1206);
			im.height = height*0.85*8;
			screen1.style.width =  height*0.85*8*(720/1206)+"px";
			screen1.style.height =  height*0.85*8+"px";
			im.style.marginTop=height*0.15*3+'px';
			var x =Math.random();
			id.onblur = function () {
        		if(id.value.length!=5||parseInt(id.value)<0||parseInt(id.value)>=100000){
        			err2.innerHTML="编号是5位数字诺~"
        			id.style.border="1px solid red";
        		}else{
        			err2.innerHTML="";
        			id.style.border="0px";
        		} 
            }
			id.onfocus = function () {
        			err2.innerHTML="";
        			id.style.border="0px";
            	}
		if(x<=0.333334){
			createit("橙蓝.png","#0A3444","#F67706");
		}else if(x<=0.666667){
			createit("红绿.png","#298264","#D23C2E");
		}else{
			createit("蓝红.png","#2496B1","#DD2422");
		}
		function createit(bac,color1,color2){
			var ctx = can.getContext("2d");
			$('#login').click(function(){
			if(id.value.length!=5||parseInt(id.value)<0||parseInt(id.value)>=100000){
				return;
			}
			$.ajax({
   					url:"https://weixin.sky31.com/mima/VoteAdmin/pages/DataVisualization/authentication.php?operate=getInfo",
   					dataType:'json',
   					method:"GET",
   					data:{
     					id:id.value//获取到的id值
  				 	},
  					success:function(datas){
     					//data就是返回回来的值，当然你变量名也可以不叫data
     					if(datas.code==0)
     					authflag=datas.data.authentication;
						if(authflag==1){
						username=datas.data.name;//我也不记得是datas['name']还是[图片]datas.name了，你试一下吧，下一个同理
						 //如果为1，表示已经认证过了，则结束认证，进行下一个环节
							err2.innerHTML="认证成功,姓名："+datas.data.name;//更新姓名
							login.innerHTML="拍&nbsp;&nbsp; 照";
							id.disabled="disabled";
						}
						else
						err2.innerHTML="认证失败，请重新输入编号";//更新姓名
  					},
				});
			if(authflag!=1){
				return;
			}
				 number++;
				 return  $("#file").click();
			});
			$('.submit').click(function(){
				if(flag==0){
					return;
				}
			/*$.ajax({
   				url:"https://weixin.sky31.com/mima/VoteAdmin/pages/DataVisualization/authentication.php?operate=identify",
   				dataType:'json',
   				method:"GET",
   				data:{
     				id:id.value//获取到的id值
  				 },
				success:function(datas){
     				authflaged=datas['code'];
  				},
			});*/
				$('.page1_5').fadeOut(500);
				$('#page2').delay(500).fadeIn(500);
				ctx.beginPath();
				ctx.font = "800 26vw -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif";
				ctx.textAlign="center";
				ctx.fillStyle = color1;
				var a=parseInt(id.value)%10;
				var b=parseInt(parseInt(id.value)/10)%10;
				var c=parseInt(parseInt(id.value)/100)%10;
				var d=parseInt(parseInt(id.value)/1000)%10;
				var e=parseInt(parseInt(id.value)/10000)%10;
				ctx.fillText(e, height*0.85*8*0.124, height*0.85*8*0.106);
				ctx.fillText(d, height*0.85*8*0.152, height*0.85*8*0.106);
				ctx.fillText(c, height*0.85*8*0.180, height*0.85*8*0.106);
				ctx.fillText(b, height*0.85*8*0.208, height*0.85*8*0.106);
				ctx.fillText(a, height*0.85*8*0.236, height*0.85*8*0.106);
				ctx.font = "400 58vw sans-serif";
				ctx.textAlign="center";
				ctx.fillStyle = color2;
				ctx.fillText(username, height*0.85*8*0.222, height*0.85*8*0.172);
				ctx.closePath();
				img1 = can.toDataURL('image/jpeg');
				/*$.ajax({
   				url:"https://weixin.sky31.com/mima/VoteAdmin/pages/DataVisualization/authentication.php?operate=sendMsg",
   					dataType:'json',
   					method:"GET",
   					data:{
     					id:id.value//获取到的id值
						pic_url:img1 //生成的证书图片地址
  				 	},
  					success:function(datas){
     					sendMsg=datas['code']
  					},
				});*/
				im.src=img1;
				setTimeout(function(){
					alert("认证成功！");
				},3000);
			});
			document.querySelector('#file').addEventListener('change', function () {
    	 	// this.files[0] 是用户选择的文件
    		lrz(this.files[0], {
    			width: 1024
    		})
        		.then(function (rst) {
            	// 把处理的好的图片给用户看看呗
            	flag=1;
            	img3.src = rst.base64;
            	photo.style.backgroundImage="url("+rst.base64+")";
            	photo.style.backgroundSize="100% 100%";
            	if( number==1){
            		$('.page1').fadeOut(500);
					$('.page1_5').delay(500).fadeIn(500);
            	} number++;
            	draw();
            	return rst;
        		});
			});
			function draw(){
        		img3.onload = function(){
        			img2.src=bac;
        			img2.onload = function(){  
        				ctx.beginPath();
						ctx.drawImage(img2,0,0, height*0.85*8*(720/1206), height*0.85*8);
						ctx.closePath();
						ctx.beginPath();
        				ctx.drawImage(img3,height*0.85*8*(720/1206)*217/613,height*0.85*8*415/1230 , height*0.85*8*(720/1206)/0.8*0.234, height*0.85*8*190/820 );
        				ctx.closePath();
        			}
        		}
			}
		}
		});
	</script>
	</body>
</html>
